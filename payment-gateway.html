<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بوابة الدفع الآمن | Wash Go</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            display: flex;
            align-items: center;
            text-align: right;
        }
        
        .payment-card {
            background: white;
            border-radius: 30px;
            padding: 30px;
            width: 100%;
            max-width: 420px;
            margin: auto;
        }
        
        .credit-card-view {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            border-radius: 20px;
            padding: 25px;
            color: white;
            height: 190px;
            box-shadow: 0 10px 20px rgba(30, 60, 114, 0.2);
            direction: ltr;
        }
        
        .card-chip {
            width: 45px;
            height: 35px;
            background: #ffc107;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .card-number-display {
            font-size: 1.2rem;
            letter-spacing: 2px;
            font-family: monospace;
            margin-bottom: 20px;
        }
        
        .form-control {
            border-radius: 12px;
            padding: 10px;
            background: #fdfdfd;
            margin-bottom: 12px;
            border: 1px solid #eee;
            font-size: 0.9rem;
        }
        
        .btn-pay-now {
            border-radius: 50px;
            padding: 12px;
            font-weight: 800;
            background: #28a745;
            color: white;
            border: none;
            width: 100%;
        }
        
        .otp-input {
            width: 45px;
            height: 45px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #ddd;
        }
        
        .modal-content {
            border-radius: 30px;
            border: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="payment-card shadow-lg">
            <div class="text-center mb-3">
                <h5 class="fw-bold mb-0">الدفع الإلكتروني الآمن</h5>
                <small class="text-muted">المبلغ المطلوب: <span id="amount-to-pay" class="fw-bold text-dark">0.00 JOD</span></small>
            </div>

            <div class="credit-card-view mb-4">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="card-chip"></div><i class="fab fa-cc-visa fs-1 opacity-75"></i></div>
                <div class="card-number-display" id="card-num-mirror">**** **** **** ****</div>
                <div class="d-flex justify-content-between small fw-bold">
                    <span id="card-name-mirror">HEND AHMED</span>
                    <span id="card-date-mirror">MM/YY</span>
                </div>
            </div>

            <form id="paymentForm">
                <input type="text" class="form-control" id="cardHolder" placeholder="اسم صاحب البطاقة" oninput="updateNameMirror()">
                <input type="text" class="form-control" id="cardNum" placeholder="رقم البطاقة" maxlength="19" oninput="updateNumMirror()">
                <div class="row g-2">
                    <div class="col-7"><input type="text" class="form-control" id="cardDate" placeholder="MM/YY" maxlength="5" oninput="formatDate(this)"></div>
                    <div class="col-5"><input type="password" class="form-control" id="cardCVV" placeholder="CVV" maxlength="3"></div>
                </div>
                <button type="button" onclick="validateAndPay()" class="btn btn-pay-now shadow mt-2">دفع الآن <i class="fas fa-shield-alt ms-1"></i></button>
            </form>

            <div class="text-center mt-3">
                <button onclick="location.href='user-dashboard.html'" class="btn btn-link text-muted text-decoration-none small"><i class="fas fa-arrow-right ms-1"></i> العودة للوحة التحكم</button>
            </div>
        </div>
    </div>

    <div class="modal fade" id="errorModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content p-4 text-center">
                <i class="fas fa-exclamation-circle fa-3x text-danger mb-3"></i>
                <h5 class="fw-bold">بيانات غير مكتملة</h5>
                <p class="text-muted small">يرجى ملء كافة الحقول للمتابعة يا هند.</p>
                <button class="btn btn-dark w-100 rounded-pill fw-bold" data-bs-dismiss="modal">فهمت</button>
            </div>
        </div>
    </div>

    <div class="modal fade" id="otpModal" tabindex="-1" data-bs-backdrop="static" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content p-4 text-center">
                <i class="fas fa-sms fa-3x text-primary mb-3"></i>
                <h5 class="fw-bold">تحقق البنك</h5>
                <div class="d-flex justify-content-center gap-2 my-4" dir="ltr">
                    <input type="text" class="form-control otp-input" maxlength="1">
                    <input type="text" class="form-control otp-input" maxlength="1">
                    <input type="text" class="form-control otp-input" maxlength="1">
                    <input type="text" class="form-control otp-input" maxlength="1">
                </div>
                <button class="btn btn-primary w-100 rounded-pill fw-bold" onclick="finalProcess()">تأكيد العملية</button>
            </div>
        </div>
    </div>

    <div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content p-5 text-center shadow-lg">
                <i class="fas fa-check-circle fa-4x text-success mb-3"></i>
                <h5 class="fw-bold">تمت العملية بنجاح!</h5>
                <p class="text-muted small">شكراً لكِ يا هند، تم تأكيد الدفع بنجاح.</p>
                <button class="btn btn-dark w-100 rounded-pill fw-bold" onclick="location.href='home.html'">متابعة الطلب</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        window.onload = () => {
            document.getElementById('amount-to-pay').innerText = (localStorage.getItem('finalPrice') || "12.00") + " JOD";
            document.getElementById('card-name-mirror').innerText = (localStorage.getItem('userName') || "HEND AHMED").toUpperCase();
        };

        function updateNameMirror() {
            let n = document.getElementById('cardHolder').value;
            document.getElementById('card-name-mirror').innerText = n.toUpperCase() || "HEND AHMED";
        }

        function updateNumMirror() {
            let el = document.getElementById('cardNum');
            el.value = el.value.replace(/\D/g, '').replace(/(.{4})/g, '$1 ').trim();
            document.getElementById('card-num-mirror').innerText = el.value || "**** **** **** ****";
        }

        function formatDate(i) {
            i.value = i.value.replace(/\D/g, '').replace(/(.{2})/, '$1/').substring(0, 5);
            document.getElementById('card-date-mirror').innerText = i.value || "MM/YY";
        }

        function validateAndPay() {
            const h = document.getElementById('cardHolder').value,
                n = document.getElementById('cardNum').value,
                d = document.getElementById('cardDate').value,
                c = document.getElementById('cardCVV').value;
            if (!h || n.length < 19 || d.length < 5 || c.length < 3) new bootstrap.Modal(document.getElementById('errorModal')).show();
            else new bootstrap.Modal(document.getElementById('otpModal')).show();
        }

        function finalProcess() {
            bootstrap.Modal.getInstance(document.getElementById('otpModal')).hide();
            setTimeout(() => {
                new bootstrap.Modal(document.getElementById('successModal')).show();
                localStorage.setItem('wash_go_order_9920_status', 'Paid');
            }, 500);
        }

        document.querySelectorAll('.otp-input').forEach((el, idx, self) => {
            el.oninput = () => el.value && idx < 3 && self[idx + 1].focus();
        });
    </script>
</body>

</html>